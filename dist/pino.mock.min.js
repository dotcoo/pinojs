!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.pinomock=t():e.pinomock=t()}(this,(function(){return function(e){var t={};function s(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";s.r(t);class r{constructor(e){this.init=e,this.method=e.method?e.method.toUpperCase():"GET",this.url=e.url,this.headers=e.headers||{},this.body=e.body||"",this.uri=new URL(e.url,window.location.href),this.response=new n}}class n{constructor(){this.status=200,this.statusText="OK",this.headers={},this.body=""}send(e){this.body=e}json(e){this.headers["Content-Type"]="application/json; charset=utf-8",this.body=JSON.stringify(e)}}class o{constructor(e){this.host=e,this.requestMiddlewares=[],this.responseMiddlewares=[],this.handlers=[]}addRequestMiddleware(e){this.requestMiddlewares.push(e)}addResponseMiddleware(e){this.responseMiddlewares.push(e)}path2regexp(e){if(e.constructor===RegExp)return e;const t=[...e.matchAll(/:([a-z_][a-z0-9_]*)/gi)].map(e=>e[1]);let s="^"+e.replace(/\//g,"\\/")+"$";for(const e of t)s=s.replace(":"+e,`(?<${e}>[a-z0-9_]+)`);return new RegExp(s,"ig")}request(e,t,s,r=!0){this.handlers.push({method:e,path:t,handle:s,useIntercept:r,pathReg:this.path2regexp(t)})}get(e,t,s=!0){this.request("GET",e,t,s)}post(e,t,s=!0){this.request("POST",e,t,s)}put(e,t,s=!0){this.request("PUT",e,t,s)}delete(e,t,s=!0){this.request("DELETE",e,t,s)}isHost(e){return this.host.constructor===RegExp?this.host.test(e):this.host===e}route(e){for(const t of this.handlers)if(t.useIntercept===e.useIntercept&&t.method===e.method&&new RegExp(t.pathReg.source,t.pathReg.flags).test(e.uri.pathname))return t;return!1}async parse(e){e.params={},e.query=Object.fromEntries(new window.URLSearchParams(e.uri.search)),e.form={},e.formData=new FormData,e.json={};const t=e.headers["Content-Type"];"POST"!==e.method&&"PUT"!==e.method||!t||(t.startsWith("application/x-www-form-urlencoded")&&(e.body instanceof window.URLSearchParams?e.form=Object.fromEntries(e.body):e.form=Object.fromEntries(new window.URLSearchParams(e.body))),t.startsWith("multipart/form-data")&&(e.formData=e.body),t.startsWith("application/json")&&(e.json=JSON.parse(e.body))),e.response=new n}async handle(e){const t=this.route(e);if(!t)return!1;this.parse(e),e.params=Object.fromEntries(new window.URLSearchParams([...e.uri.pathname.matchAll(new RegExp(t.pathReg.source,t.pathReg.flags))].pop().groups));for(const t of this.requestMiddlewares)if(await t(e),e.ended)return e.response,!0;await t.handle(e);for(const t of this.responseMiddlewares)if(await t(e),e.ended)return e.response,!0;return e.response,!0}}window.XMLHttpRequestReal=window.XMLHttpRequest;class i extends window.XMLHttpRequestReal{getAllResponseHeaders(){if(!this.req||!this.req.response)return super.getAllResponseHeaders();let e="";for(const t in this.req.response.headers)e+=`${t}: ${this.req.response.headers[t]}\r\n`;return e}getResponseHeader(e){return this.req&&this.req.response?this.req.response.headers[e]:super.getResponseHeader(e)}open(e,t,s=!0,...n){super.open(e,t,s,...n),this.req=new r({method:e,url:t})}setRequestHeader(e,t){super.setRequestHeader(e,t),this.req.headers[e]=t}async send(...e){this.sendInit(...e),await this.sendRequest(...e)&&this.sendResponse()}sendInit(...e){this.setRequestHeader("X-Requested-With","XMLHttpRequest"),this.req.headers.Host=this.req.uri.host,this.req.headers["User-Agent"]=window.navigator.userAgent,this.req.headers.Accept="*/*",this.req.headers.Referer=window.location.href,this.req.headers["Accept-Language"]=window.navigator.language,this.req.headers.Cookie=window.document.cookie,this.req.body=e.length?e[0]:""}async sendRequest(...e){if(this.req.useIntercept=!0,await i.handle(this.req))return!0;return this.req.useIntercept=!1,!await new Promise(t=>{this.onerror2=this.onerror,this.onerror=e=>{console.log("XMLHttpRequest error:",e),t(!1)},this.ontimeout2=this.ontimeout,this.ontimeout=e=>{console.log("XMLHttpRequest meout:",e),t(!1)},this.onload2=this.onload,this.onload=()=>{this.req.response.status=this.status,this.req.response.statusText=this.statusText,4===this.readyState&&(this.status>=500||404===this.status)&&t(!1),4===this.readyState&&this.status<500&&404!==this.status&&(t(!0),this.onload2&&this.onload2())},this.onreadystatechange2=this.onreadystatechange,this.onreadystatechange=()=>{this.req.response.status=this.status,this.req.response.statusText=this.statusText,4===this.readyState&&(this.status>=500||404===this.status)&&t(!1),4===this.readyState&&this.status<500&&404!==this.status&&(t(!0),this.onreadystatechange2&&this.onreadystatechange2())},super.send(...e)})&&(i.route(this.req)||(this.onerror2?this.onerror2():this.ontimeout2&&this.ontimeout2()),this.req.useIntercept=!1,await i.handle(this.req),!0)}sendResponse(){Object.defineProperties(this,{readyState:{value:4,configurable:!0,enumerable:!0,writable:!0},status:{value:200,configurable:!0,enumerable:!0,writable:!0},statusText:{value:"OK",configurable:!0,enumerable:!0,writable:!0},responseText:{value:"",configurable:!0,enumerable:!0,writable:!0},response:{value:null,configurable:!0,enumerable:!0,writable:!0}}),this.readyState=4,this.status=this.req.response.status,this.statusText=this.req.response.statusText,this.response=this.responseText=this.req.response.body,"json"===this.responseType&&(this.response=""===this.responseText?{}:JSON.parse(this.responseText)),this.onload?this.onload():this.onreadystatechange&&this.onreadystatechange()}}i.route=function(e){return!1},i.handle=async function(e){e.response.status=444};var a=i;async function u(e,t={},...s){const n=new r({...t,url:e});if(n.useIntercept=!0,await u.handle(n))return new window.Response(n.response.body,{status:n.response.status,statusText:n.response.statusText,headers:new window.Headers(n.response.headers)});n.useIntercept=!1;try{return await window.fetchReal(e,t,...s)}catch(e){if(console.log("fetch error:",e),!u.handle(n))throw e}return await u.handle(n),new window.Response(n.response.body,{status:n.response.status,statusText:n.response.statusText,headers:new window.Headers(n.response.headers)})}window.fetchReal=window.fetch,u.route=function(e){return!1},u.handle=async function(e){e.response.status=444};var h=u;function d(e){e.Request=r,e.Response=n,e.Server=o,e.XMLHttpRequest=a,e.fetch=h,e.server=new e.Server(window.location.host),e.addRequestMiddleware=e.server.addRequestMiddleware.bind(e.server),e.addResponseMiddleware=e.server.addResponseMiddleware.bind(e.server),e.request=e.server.request.bind(e.server),e.get=e.server.get.bind(e.server),e.post=e.server.post.bind(e.server),e.put=e.server.put.bind(e.server),e.delete=e.server.delete.bind(e.server),e.servers=[e.server],e.addServer=function(e){this.servers.push(e)},e.route=function(e){for(const t of this.servers)if(t.isHost(e.uri.host)&&t.route(e))return!0;return!1},e.handle=async function(e){for(const t of this.servers)if(t.isHost(e.uri.host)&&await t.handle(e))return!0;return!1},e.XMLHttpRequest.route=e.route.bind(e),e.XMLHttpRequest.handle=e.handle.bind(e),e.fetch.route=e.route.bind(e),e.fetch.handle=e.handle.bind(e),e.intercept=function(){window.XMLHttpRequest=e.XMLHttpRequest,window.fetch=e.fetch},e.unintercept=function(){window.XMLHttpRequest=window.XMLHttpRequestReal,window.fetch=window.fetchReal},e.intercept()}s.d(t,"default",(function(){return d}))}]).default}));
//# sourceMappingURL=pino.mock.min.js.map